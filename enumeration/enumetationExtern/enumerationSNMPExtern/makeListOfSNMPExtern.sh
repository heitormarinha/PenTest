#!/bin/bash

#Importing modules.
source /home/heitor/Documents/PenTest/modules/bash/bash.sh

#Black box.
#Filtering the host and port what are launching the snmp service.
for line in $(cat $hostsWithOpenedTCPPortsExtern | grep "*snmp*" | sed $regexRemoveWhiteSpace):
do
    domain=$(echo $line | grep -o $regexGetIP)
    port=$(echo $line | grep -o $regexGetPortOfSNMPServiceNmapOutPutGrepbleList | cut -d "/" -f 1)
    echo "$domain $port" >> $enumerationSNMPExtern
done

#Look up for community in hosts with the SNMP service launching.
for line in $(cat  $enumerationSNMPExtern | sed $regexRemoveWhiteSpace):
do
    #Add IP and community to enumerationSNMPExternenumerationSNMPExtern list.
    domain=$(echo $line | grep -o $regexGetIP)
    records=$(sudo onesixtypeone -c $communitySNMPList $ipNetowork/$cidr | sed $regexRemoveWhiteSpace)
    for record in $records:
    do
        domain=$(echo $record | grep -o $regexGetIP)
        community=$(echo $record | grep -o $regexGetCommunity)
        echo "$domain $community" >> $enumerationSNMPExtern
    done
done

