#!/bin/bash

#importing modules.
source /home/heitor/Documents/PenTest/modules/bash/bash.sh

#Getting the hosts with a netbios and/or smb service launching. 
for line in $(cat  $hostsWithOpenedTCPPortsExtern | grep -i "smb|netbios" | sed $regexRemoveWhiteSpace):
do
    echo "===$domain==="
    domain=$(echo $line | grep -o $regexGetIP)
    #Getting the nfs services and the version suported by host.
    sudo rpcinfo -p | grep nfs >> $domain $enumerationNFSExtern
    domain=$(echo $line | grep -o $regexGetIP)
    #Removing the title of showmountand handling only the directies that habe been shared.
    directories=$(sudo showmount -e $domain | 
    grep -v "Export\ list\ for")
    
    for directory in $directories:
    do
        echo "$directory" >> $enumerationNFSExtern
        mkdir /tmp/$domain/nfs
        mountedNFSFolder="/tmp/$domain/nfs"
        mount -t nfs -o nfsvers=2 $domain:$directory $mountedNFSFolder
    done
done

#! Now wee need check the folder /tmp
