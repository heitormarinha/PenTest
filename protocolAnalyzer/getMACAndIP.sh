#!/bin/bash

#Getting  the  MAC Addresses - source and destination
SRC_MAC_ADDRESS=$(tcpdump -enr $log  | cut -d" " -f 2 | sort | uniq -c | head | sort -nr | nl | awk '{ if ($log == 1)print $3 }')

#Getting  the  MAC Addresses - source and destination
DST_MAC_ADDRESS=$(tcpdump -enr $log  |cut -d" " -f 2 | sort | uniq -c | head |sort -nr | nl | awk '{ if ($log == 2)print $3 }')

#This sentence puts the 6th fields of bytes-files in SRCMACADDRESS variable
SRC_MAC_VENDOR_ADDRESS=$(echo "$SRC_MAC_ADDRESS" | cut -d":" -f1-3 )

#This sentence puts the 7-12th fields in SRCMACADDRESS variable
DST_MAC_VENDOR_ADDRESS=$(echo "$DST_MAC_ADDRESS" | cut -d":" -f1-3)

#Getting  the IP addresses
SRC_IP_ADDRESS=$(echo $( tcpdump -ner $log ether src $SRC_MAC_ADDRESS and ether dst $DST_MAC_ADDRESS and tcp[13] ==16 | cut -d " " -f10- | cut -d" " -f1-3 | cut -d"." -f1-4 | sort -u))

#Getting  the IP addresses
DST_IP_ADDRESS=$(echo $(tcpdump -nr $log src $SRC_IP_ADDRESS | cut -d" " -f3- | cut -d" " -f1-3 | cut -d" " -f3 | cut -d"." -f1-4 | sort |  uniq -c | sort -urn | head | nl | awk '{ if ($log == 1)print $3 }'))

#This command will look up for vendor in file "Vendor_MACs_Addrresses" and will put in SRC_MAC_VENDOR_NAME if match
#the grep -i --ignore the Upercases
SRC_MAC_VENDOR_NAME=$(cat Vendors-MACs-Addresses | grep -i $SRC_MAC_VENDOR_ADDRESS |cut -d" " -f2-)

#This command will look up for vendor in file "Vendor_MACs_Addrresses" and will put in DST_MAC_VENDOR_NAME if match
DST_MAC_VENDOR_NAME=$(cat Vendors-MACs-Addresses | grep -i $DST_MAC_VENDOR_ADDRESS |cut -d" " -f2-)


echo "_________________________________________"
echo "Listing MAC Addresses in actionn"
echo "_________________________________________"
tcpdump -enr $log  |cut -d" " -f 2 | sort | uniq -c | head |sort -nr
#Output example
<< example1
     1    94317 00:22:5a:75:34:1e
     2    80651 d4:ab:82:45:c4:0c
     3        9 d4:dc:cd:9e:fe:12
     4        8 a4:5e:60:b8:d1:af
example1
echo "Source MAC address > $SRC_MAC_ADDRESS"
echo "Destination  MAC address > $DST_MAC_ADDRESS"
echo "SRC_MAC_VENDOR $SRC_MAC_VENDOR_ADDRESS > $SRC_MAC_VENDOR_NAME"
echo "DST_MAC_VENDOR $DST_MAC_VENDOR_ADDRESS > $DST_MAC_VENDOR_NAME"
echo ""
echo "_________________________________________"
echo "Listing IP Addresses in actionn"
echo "_________________________________________"
LIST_TOP_IP_ADDRESSES=$(echo $(tcpdump -nr invasao.pcap  src $SRC_IP_ADDRESS | cut -d" " -f3- | cut -d" " -f1-3 | cut -d" " -f3 | cut -d"." -f1-4 | sort | uniq -c | sort -rn | head | cut -c 9- ))

echo "$LIST_TOP_IP_ADDRESSES" | awk '{for (i = 1; i <=NF; i++) printf "%s\n",$i}'

echo ""
echo "Source IP address > $SRC_IP_ADDRESS"
echo "Destination  IP  address > $DST_IP_ADDRESS"
echo ""
echo "_________________________________________"
echo "Listing the open ports target ports"
echo "_________________________________________"
#Listing the open ports target ports
LIST_OPEN_PORTS=$(echo $(tcpdump -ner $log  ether src  $SRC_MAC_ADDRESS and ether dst $DST_MAC_ADDRESS and tcp[13] ==16 | cut -d " " -f10- | cut -d " " -f3 | cut -d"." -f 5 | sort -u))

echo "_________________________________________"
echo "$LIST_OPEN_PORTS" | awk ' {for (i = 1; i <=NF; i++) printf "%s\n",$i}'

echo "_________________________________________"
echo "_________________________________________"
